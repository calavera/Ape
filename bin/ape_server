#!/usr/bin/env ruby
#   Copyright (c) 2006 Sun Microsystems, Inc. All rights reserved
#   Use is subject to license terms - see file "LICENSE"
$:.unshift File.dirname(__FILE__) + '/../lib'
$:.unshift File.dirname(__FILE__) + '/../sinatra'

require 'rubygems'
require 'optparse'

require 'atom_exerciser'

OPTIONS = {
  :host => '0.0.0.0',
  :port => '4000',
  :home => nil
}

parser = OptionParser.new do |opts|
  opts.banner = 'The ape server options:'
  opts.separator ''
  opts.on('-a', '--address ADDRESS', 'Address to bind to', "default: #{OPTIONS[:host]}") { |v| OPTIONS[:host] = v }
  opts.on('-p', '--port PORT', 'Port to bind to', "default: #{OPTIONS[:port]}") { |v| OPTIONS[:port] = v }
  opts.on('-d', '--directory DIRECTORY', 'ape home directory', "default: #{::Ape.home}") { |v| OPTIONS[:home] = v }
  opts.on('-h', '--help', 'Displays this help') { puts opts; exit }
  opts.parse!(ARGV)
end

::Ape.home = OPTIONS.delete(:home)
AtomExerciser.run!(OPTIONS)
